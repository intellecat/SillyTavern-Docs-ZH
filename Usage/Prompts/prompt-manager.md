---
order: 50
templating: false
route: /usage/prompts/prompt-manager/
---

# 提示词管理器

提示词管理器是一个系统，允许对 Chat Completion API 的[提示词构建](index.md)策略进行更多控制。

!!! 适用于：Chat Completion API
对于 Text Completion API，请使用[高级格式化](advancedformatting.md)获取等效设置。
!!!

!!!tip 命名提示词管理器预设
请注意，如果预设与您的某个角色卡片共享名称，在与该特定角色开始聊天时，它将被自动选择。为预设命名一些独特的名称以避免这种行为。
!!!

通过点击导航栏中的"AI 回应配置"按钮访问提示词管理器。提示词管理器位于[常用设置](/Usage/Common-Settings.md)面板下方。

## 快速提示词编辑

提供快速编辑常见提示词部分的空间，如 **主提示词**、**辅助提示词** 和 **历史后指令**。有关这些提示词的更多信息可以在[提示词构建](index.md)页面找到。

## 实用提示词

这些提示词被发送到 Chat Completion 模型，以帮助它理解发送给它的信息，或在某些类型的交互中指示它以特定方式行动。

### 格式模板

!!!tip
如果未设置格式模板，信息将按原样发送，不进行任何包裹。
!!!

这些是用于包裹从[世界信息](/Usage/worldinfo.md)和[角色卡片](/Usage/Characters/characterdesign.md)提取的信息的字符串模板。

使用特殊标记来指示应插入信息的位置：

- `{0}` 用于世界信息格式模板。
- `{{scenario}}` 用于场景格式模板。
- `{{personality}}` 用于个性格式模板。

### 群组提示模板

仅在群组聊天中使用。放置在提示词末尾以强制特定角色回复。

将此留空以禁用群组提示功能。

### 新聊天、新群组聊天、新示例聊天

这些在聊天历史之前和每个[示例对话](/Usage/Characters/characterdesign.md#examples-of-dialogue)块之前发送，以告知模型背景信息在哪里结束，聊天历史在哪里开始。

- **新聊天：** 用于单独聊天。
- **新群组聊天：** 用于群组聊天。
- **新示例聊天：** 用于示例对话块。

将这些留空以禁用此功能。

### 续写提示

在提示词末尾发送，以指示模型在触发续写时该做什么，例如当按下续写按钮或由 STScript 触发时。

!!! Chat Completion 模型的续写
请记住，Chat Completion 模型处理续写的方式与 **Text Completion** 模型不同，无论您的续写提示如何，可能并不总是提供无缝的结果。
!!!

### 替换空消息

当文本框为空且按下 **发送消息** 时，发送此字段的内容而不是空白消息。

## 角色名称行为

提供不同的策略来指示模型如何将消息与角色关联。如果 Chat Completion 模型在确定哪些消息属于哪个角色时遇到困难，可能需要选择不同的策略。

## 续写后缀

当触发续写时，模型返回的"续写"消息将在开头添加选定的续写后缀。例如，它可以在续写文本之前添加一个空格。

## 附加设置

### 用引号包裹

!!!warning
已弃用的选项。优先使用[正则表达式脚本](/extensions/Regex.md)。
!!!

在发送之前将整个用户消息包裹在隐藏的引号中。这对于角色不使用引号表示语言的会话很有用。如果您的会话使用引号表示语言，请不要选中此项。

### 续写预填充

!!!warning
可能不适用于所有 Chat Completion 源。
!!!

将续写提示作为助手角色消息而不是系统消息发送。如果启用此选项，将不使用续写提示。

### 压缩系统消息

!!!warning
已弃用的选项。优先使用[提示词后处理](/Usage/API_Connections/openai.md#prompt-post-processing)。
!!!

将连续的系统消息合并为单个组合消息(不包括示例对话)。

### 启用网络搜索

!!!
不要与[网络搜索扩展](/extensions/WebSearch.md)混淆。
!!!

启用 Chat Completion 后端提供的网络搜索功能。提示词通常由模型提供商使用搜索结果丰富，可能会产生额外费用。

### 启用函数调用

请参阅[函数调用](/For_Contributors/Function-Calling.md)

### 发送内联图像、发送内联视频

!!!
不要与[图像描述扩展](/extensions/captioning.md)混淆。
!!!

如果 Chat Completion 模型具有处理提交的图像和视频的多模态能力，这将切换其执行此操作的能力。要将媒体附加到提示词，请使用"魔杖"菜单中的 **附加文件** 选项。

### 请求内联图像

!!!
不要与[图像生成扩展](/extensions/Stable-Diffusion.md)混淆。
!!!

允许模型返回图像附件。

### 使用系统提示词

!!!
仅由 Google Gemini 和 Anthropic Claude 后端支持。

尽管这两者有非常相似的设置，但它们在技术上是单独的选项，因此可以分别配置。
!!!

将所有系统消息合并到第一条非系统角色(用户/助手)消息之前，并将它们作为单独的系统指令字段发送。

## 推理设置

如果 Chat Completion 模型使用推理，这些设置会影响其可见性和功能。

### 请求模型推理

请参阅[添加推理：按后端](/Usage/Prompts/reasoning.md#by-backend)。

### 推理强度

请参阅[推理强度](/Usage/Prompts/reasoning.md#reasoning-effort)。

## "提示词"部分

提示词管理器构成了发送到 Chat Completion 模型的提示词的骨干。它控制发送什么以及发送的 *顺序*。

### 提示词下拉列表

包含当前 Chat Completion 预设包含的所有(非默认)提示词的下拉列表。要将这些提示词之一添加到传出消息中，需要从下拉列表中选择它，然后按 **插入提示词** 按钮将其添加到提示词管理器。要创建一个新的提示词添加到此下拉列表，请按 **新建提示词** 按钮。一旦新提示词被编写并保存，它就会被添加到下拉列表中，然后可以插入。

### 提示词列表

这是一个拖放界面，列出了选择可能发送到 Chat Completion 模型的提示词。放置在界面 **顶部** 附近的提示词发送得更早。列表的 **底部** 是发送到模型的 **最后一件事**(通常，这将是您的 **历史后指令**)。

!!! "固定"提示词 = 默认提示词
默认提示词不能从选定的提示词列表中删除。这包括主提示词、世界信息(之前/之后)、人设描述、角色描述、角色个性、场景、增强定义、辅助提示词、聊天示例、聊天历史和历史后指令。如果不需要这些，可以将它们 **切换为"关闭"**，但不能直接删除。
!!!

## 编辑提示词

点击提示词上的 **铅笔按钮** 将带您到 **编辑界面**。在这里，您可以直接编辑提示词。

!!! 确保保存您的更改！
要将这些提示词的更改永久保存到您的 Chat Completion 预设中，您必须点击 **编辑界面** 右下角的 **保存** 按钮，并通过使用位于 **AI 回应配置** 部分顶部的 **保存** 按钮保存预设本身！否则，当 Chat Completion 预设切换到不同的预设时，所做的更改将丢失。
!!!

### 名称

提示词的名称。这不会发送到 Chat Completion 模型；它仅供您在提示词管理器中参考。

### 角色

哪个角色发送提示词。您可以在系统、AI 助手或用户之间选择。

### 触发器

发送此提示词的生成类型。如果未选择任何内容，则提示词将针对所有生成类型发送。如果选择了一个或多个，则提示词将仅针对这些特定生成类型发送：

- **普通：** 常规消息生成请求。
- **续写：** 当按下续写按钮时。
- **扮演：** 当按下扮演按钮时。
- **滑动：** 当通过滑动触发生成时。
- **重新生成：** 当在单独聊天中按下重新生成按钮时。
- **安静：** 后台生成请求，通常由[扩展](/extensions/index.md)或[STscript](/For_Contributors/st-script.md)命令触发。

!!!
"重新生成"触发器在群组聊天中不可用，因为它使用不同的再生成逻辑：从最后一次回复中删除所有消息，并根据选择的[群组回复策略](/Usage/Characters/groupchats.md#reply-order-strategies)使用"普通"生成类型排队消息。
!!!

### 位置

当位置设置为 **相对** 时，此提示词在拖放界面中与所有其他提示词一起发送到其所在的位置。当它设置为 **聊天内** 并给定 **深度** 时，它会以选定的角色在 **聊天历史内** 发送，并 **忽略** 拖放界面的顺序。

### 深度

当位置设置为 **聊天内** 时，这定义了提示词在聊天历史中发送的深度。数字越大，发送得越深。例如，深度为 0 将在最后一条聊天消息之后发送，深度为 1 将在最后一条聊天消息之前发送，深度为 2 将在倒数第二条聊天消息之前发送，依此类推。

### 顺序

!!!
具有相同角色和深度的提示词将被分组在一起，并按其顺序值排序。
顺序如下(从上到下)：用户、AI 助手、系统。
!!!

当位置设置为 **聊天内** 时，这定义了提示词在聊天历史中发送的顺序。数字越小，发送得越早。

## 构建您的提示词：提示和技巧

访问 SillyTavern 文档的[提示词构建](index.md)部分，了解有关如何编写有效提示词的更多信息。这些信息在很大程度上可以应用于 Chat Completion 预设。
